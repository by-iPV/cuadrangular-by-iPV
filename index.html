<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>1er Cuadrangular Voleibol Tixkokob 2026</title>

<style>

/* ----------------------------------------------------------
   ESTILOS BASE (NO MODIFICADOS)
-----------------------------------------------------------*/

body {
    background: #000;
    font-family: Arial, sans-serif;
    color: #fff;
    text-align: center;
    margin: 0;
    padding: 0;
}

h1 {
    color: #FBB400;
    font-size: 38px;
    font-weight: 900;
    text-shadow: 0 0 15px #FBB400;
    margin-top: 25px;
}

h6 {
    color: #FBB400;
    font-size: 16px;
    font-weight: 900;
    text-shadow: 0 0 15px #FBB400;
    margin-top: 25px;
}

/* Tarjeta de partido (no modificada) */
.match-box {
    background: #111;
    border: 3px solid #FBB400;
    border-radius: 18px;
    padding: 18px;
    box-shadow: 0 0 22px #FBB40080;
    text-align: center;
    font-size: 17px;
}

/* Tarjeta de partido (no modificada) */
.score-match-box {
    background: #111;
    border: 3px solid #FBB400;
    border-radius: 18px;
    padding: 1px;
    box-shadow: 0 0 22px #FBB40080;
    text-align: center;
    font-size: 64px;
}

/* L√≠nea del bracket */
.bracket-line {
    border-color: #FBB400;
}


/* ----------------------------------------------------------
   CAMBIANDO EXACTAMENTE, SIN REEMPLAZAR TARJETAS
   GRID TIPO EXCEL: 7 columnas, 15 filas
-----------------------------------------------------------*/
.bracket-container {
    display: grid;
    grid-template-columns:
        400px   /* Col 1 ‚Äì Semifinales */
        40px    /* Col 2 ‚Äì l√≠nea */
        40px    /* Col 3 ‚Äì l√≠nea */
        400px;  /* Col 4 ‚Äì Final */
    grid-template-rows: repeat(15, 45px);
    gap: 0;
    width: 1200px;
    margin: 40px auto;
}

    .match-title {
        font-weight: bold;
        margin-bottom: 24px;
        color: #FBB400;
        text-shadow: 0 0 6px rgba(251,180,0,0.8);
    }

    .icon {
        font-size: 18px;
        margin-right: 6px;
        color: #FFD978;
    }

    .team-line {
        padding: 4px 0;
		margin-bottom: 24px;
        border-bottom: 1px solid #333;
        color: #FFF;
    }

    .meta {
        font-size: 17px;
        margin-top: 0px;
        color: #FFD978;
		font-weight: bold;
    }
	
    .score-match-title {
        font-weight: bold;
        margin-bottom: 1px;
        color: #FBB400;
        text-shadow: 0 0 1px rgba(251,180,0,0.8);
    }	

    .score-team-line {
		padding: 1px 0;
		margin-bottom: 1px;
        border-bottom: 1px solid #333;
        color: #FFF;
    }
	
    .score-icon {
        font-size: 64px;
        margin-right: 6px;
        color: #FFD978;
    }
	
    .score-marcador {
        font-weight: bold;
        margin-bottom: 1px;
        color: #FBB400;
        text-shadow: 0 0 1px rgba(251,180,0,0.8);
    }
	
/* ----------------------------------------------------------
   BRACKETS ‚Äì estilo Excel
-----------------------------------------------------------*/

/* L√≠nea vertical simple */
.line-vertical {
    border-right: 3px solid #FBB400;
    width: 100%;
    height: 100%;
}

/* L√≠nea horizontal simple */
.line-horizontal {
    border-top: 3px solid #FBB400;
    width: 100%;
    height: 100%;
}

/* L√≠nea en L (cuartos ‚Üí semifinales) */
.line-corner-right {
    border-right: 3px solid #FBB400;
    border-top: 3px solid #FBB400;
}

.line-corner-left {
    border-left: 3px solid #FBB400;
    border-top: 3px solid #FBB400;
}

/* ----------------------------------------------------------
   BRACKETS ‚Äì Segunda Capa - OVERLAY
-----------------------------------------------------------*/

/* ===== Overlay LIVE / ON-DEMAND ===== */
/* ----------------------------------------------------------
   BRACKETS ‚Äì Segunda Capa - OVERLAY
----------------------------------------------------------- */

/* ===== Overlay LIVE / ON-DEMAND ===== */
.bracket-overlay {
  position: absolute;
  top: 40px;
  right: 40px;
  z-index: 50;
}

.bracket-overlay.hidden {
  display: none;
}

.live-card {
  background: #111;
  border: 3px solid #FBB400;
  border-radius: 18px;
  padding: 18px 22px;
  width: 320px;
  box-shadow: 0 0 28px #FBB40080;
  color: #fff;
}

/* Cabecera */
.live-header {
  text-align: center;
  margin-bottom: 12px;
}

.live-indicator {
  background: #FBB400;
  color: #000;
  font-weight: bold;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 14px;
}

/* Marcador */
.live-match {
  display: flex;
  align-items: center;
  justify-content: space-between;
  font-size: 22px;
  margin: 16px 0;
}

.team {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 40%;
}

.team span:last-child {
  font-size: 32px;
  font-weight: bold;
}

.vs {
  font-size: 26px;
  font-weight: bold;
}

/* Acci√≥n */
.live-actions {
  text-align: center;
  margin-top: 12px;
}

.live-btn {
  display: inline-block;
  background: #FBB400;
  color: #000;
  padding: 8px 16px;
  border-radius: 14px;
  font-weight: bold;
  text-decoration: none;
}

/* =========================================
   CAPA 2 ‚Äî Overlay LIVE / ON-DEMAND
   Video responsive (Facebook LIVE / Replay)
   ========================================= */

.video-wrapper {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%; /* 16:9 */
    height: 0;
    overflow: hidden;
    border-radius: 10px;
    background: #000;
}

.video-wrapper iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
}


/* ================================
   Fondo Institucional iPV
   ================================ */

body {
    margin: 0;
    font-family: "Segoe UI", Arial, sans-serif;

    background:
        linear-gradient(
            135deg,
            rgba(251,180,0,0.15),
            rgba(245,245,242,0.95)
        ),
        url("Club_Felipinos_v20_by_iPV.jpeg");

    background-repeat: no-repeat;
    background-size: cover;
    background-position: center;

    min-height: 100vh;
}

/* Capa difuminada institucional */
.dashboard-overlay {
    position: fixed;
    inset: 0;

    background:
        radial-gradient(
            circle at center,
            rgba(0,0,0,0.55),
            rgba(0,0,0,0.85)
        );

    backdrop-filter: blur(6px);
    z-index: -1;
}

/* Garantizar legibilidad */
.card,
.match-box,
.score-match-box {
    background: rgba(10,10,10,0.92) !important;
    color: #F5F5F2 !important;
}

/* ================================
   Panel LIVE
   ================================ */

.live-panel{
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
}

/* ================================
   BOT√ìN LIVE CONTROLADO (ATG)
   ================================ */

.live-link{
    color: #FBB400;
    font-weight: 600;
    font-size: 14px;              /* ‚Üê Tama√±o fijo */
    text-decoration: none;

    border: 1px solid #FBB400;
    padding: 4px 12px;            /* ‚Üê Control de ancho */
    border-radius: 6px;

    max-width: 140px;             /* ‚Üê L√≠mite visual */
    text-align: center;

    white-space: nowrap;         /* ‚Üê Evita saltos */
    overflow: hidden;
    text-overflow: ellipsis;

    transition: background .2s ease,
                color .2s ease,
                box-shadow .2s ease;
}


.live-link:hover{
    background:#FBB400;
    color:#000;
}


/* ================================
   LIVE ACTIVO (BONUS PRO)
   ================================ */

.live-link.live-active{
    animation: pulse 1.5s infinite;
    box-shadow: 0 0 8px rgba(251,180,0,.8);
}

@keyframes pulse{
    0%{opacity:.6;}
    50%{opacity:1;}
    100%{opacity:.6;}
}

/* ================================
   BOT√ìN ID PARTIDO
   ================================ */

.match-id-btn{
    background: transparent;
    border: 1px solid #FBB400;

    color: #FBB400;
    font-size: 13px;
    font-weight: 600;

    padding: 4px 12px;
    border-radius: 6px;

    cursor: pointer;

    max-width: 140px;
    text-align: center;

    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;

    transition: all .2s ease;
}

.match-id-btn:hover{
    background: #FBB400;
    color: #000;
}

/* ================================
   PANEL INFO LATERAL
   ================================ */

.match-info-panel{
    position: fixed;

    top: 0;
    right: -320px;

    width: 300px;
    height: 100%;

    background: rgba(0,0,0,0.95);

    border-left: 2px solid #FBB400;

    transition: right .3s ease;

    z-index: 9999;
}

.match-info-panel.active{
    right: 0;
}

.match-info-card{
    padding: 20px;

    color: #FBB400;
}

.match-info-card h3{
    margin-bottom: 12px;
}

.match-info-card button{
    margin-top: 16px;

    background: transparent;
    border: 1px solid #FBB400;

    color: #FBB400;

    padding: 6px 12px;
    border-radius: 6px;

    cursor: pointer;
}

.match-info-card button:hover{
    background: #FBB400;
    color: #000;
}

/* ================================
   Barra superior marcador
   ================================ */

.match-top-bar{
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

/* Bot√≥n ID */

.match-id-btn{
    background: transparent;
    border: 1px solid #FBB400;
    color: #FBB400;
    font-weight: bold;
    padding: 4px 10px;
    border-radius: 6px;
    cursor: pointer;

    transition: all .2s ease;
}

.match-id-btn:hover{
    background:#FBB400;
    color:#000;
}

/* LIVE */

.live-link{
    font-size: 14px;
}

/* ================================
   Panel Actualizaci√≥n
   ================================ */

.update-panel{
    display: flex;
    justify-content: space-between;
    align-items: center;

    margin-top: 6px;
    padding: 4px 8px;

    font-size: 0.85rem;
    color: #F5F5F2;

    opacity: 0.9;
}

.clock-now{
    font-weight: bold;
}

.last-update{
    color: #FBB400;
    font-weight: 600;
}

</style>
</head>

<body>
<h1 id="eventTitle">1er Cuadrangular Voleibol Tixkokob 2026</h1>
<h6>by iPV</h6>


<div class="bracket-container">

<!-- ========================================================
     SEMIFINALES (COLUMN 4) Jornada-1 y Jornada-2
======================================================== -->
<!-- Semifinal 1: filas 3‚Äì4 -->
<div class="match-box" data-match="Jornada-1" data-match-id="Jornada-1-1" style="grid-column:1; grid-row:1 / 5;">

  <div class="match-title">
    <span class="icon">üèê</span> Jornada 1
  </div>

  <div class="team-line">
    <span class="team1">Centinelas/Pretorianas by iPV</span>
    <span class="vs"> vs </span>
    <span class="team2">Felipinos Preparatoria</span>
  </div>

  <div class="meta">
    Fecha: 24/Ene | Hora: 17:00 | Marcador: 0 - 2
  </div>


</div>


<!-- Semifinal 2: filas 11‚Äì12 -->
<div class="match-box" data-match="Jornada-2" style="grid-column:1; grid-row:9 / 13;">

  <div class="match-title">
    <span class="icon">üèê</span> Jornada 2
  </div>

  <div class="team-line">
    <span class="team1">Centinelas Prepa - CDK</span>
    <span class="vs"> vs </span>
    <span class="team2">Felipinos Secundaria</span>
  </div>

  <div class="meta">
    Fecha: 24/Ene | Hora: 18:00 | Marcador: 2 - 0
  </div>

</div>

<!-- ========================================================
     BRACKETS SEMIFINALES ‚Üí FINAL (COLUMNAS 5‚Äì6)
======================================================== -->

<!-- Horizontal hacia semis -->
<div class="line-horizontal" style="grid-column:2; grid-row:3;"></div>
<!-- Vertical de P1 (fila 4) -->
<div class="line-vertical" style="grid-column:2; grid-row:3;"></div>
<!-- Vertical de P1 (fila 4) -->
<div class="line-vertical" style="grid-column:2; grid-row:4;"></div>
<!-- Vertical de P1 (fila 5) -->
<div class="line-vertical" style="grid-column:2; grid-row:5;"></div>
<!-- Vertical de P1 (fila 6) -->
<div class="line-vertical" style="grid-column:2; grid-row:6;"></div>
<!-- Vertical de P1 (fila 7) -->
<div class="line-vertical" style="grid-column:2; grid-row:7;"></div>
<!-- Horizontal hacia semis -->
<div class="line-horizontal" style="grid-column:3; grid-row:7;"></div>
<!-- Vertical de P1 (fila 4) -->
<div class="line-vertical" style="grid-column:2; grid-row:8;"></div>
<!-- Vertical de P1 (fila 5) -->
<div class="line-vertical" style="grid-column:2; grid-row:9;"></div>
<!-- Vertical de P1 (fila 5) -->
<div class="line-vertical" style="grid-column:2; grid-row:10;"></div>
<!-- Horizontal hacia semis -->
<div class="line-horizontal" style="grid-column:2; grid-row:11;"></div>

<!-- ========================================================
     FINAL (COLUMN 7 ‚Äì filas 7‚Äì8) Tercer-lugar-3 y Final-4

======================================================== -->

<div id="Final-4" class="match-box" style="grid-column:4; grid-row:5 / 9;">
            <div class="match-title"><span class="icon">üèÜ</span>Final</div>
            <div class="team-line">Felipinos Preparatoria </span>
			<span class="vs"> vs </span>
			<span class="team2">Centinelas Prepa - CDK </span>
			</div>
            <div class="meta">Fecha: 24/Ene | Hora: 20:00 | Marcador: 0 - 2</div>
</div>



<!-- ========================================================
     PARTIDO POR 3ER LUGAR (COLUMN 7 ‚Äì filas 14‚Äì15)
======================================================== -->

<div id="Tercer-lugar-3" class="match-box" style="grid-column:4; grid-row:12 / 16;">
                <div class="match-title"><span class="icon">ü•â</span>3er Lugar</div>
                <div class="team-line">Centinelas/Pretorianas by iPV </span>
				<span class="vs"> vs </span>
				<span class="team2">Felipinos Secundaria </span>
				</div>
                <div class="meta">Fecha: 24/Ene | Hora: 19:00 | Marcador: 2 - 0</div>
</div>


</div> <!-- grid  del bracket container-->

<!-- ========================================================
     Marcador y transmisi√≥n de partido LIVE - ON DEMAND (COLUMN 7 ‚Äì filas 14‚Äì15)
======================================================== -->
<!-- CAPA 2 ‚Äî Overlay LIVE / ON-DEMAND -->
<div id="liveOverlay" class="bracket-overlay hidden">
  <div class="live-card">
    <div class="live-header">
      <span class="live-indicator">EN VIVO</span>
    </div>

    <div class="live-match">
      <div class="team team-a">
        <span id="teamAName">Equipo A</span>
        <span id="scoreA">0</span>
      </div>

      <div class="vs">:</div>

      <div class="team team-b">
        <span id="scoreB">0</span>
        <span id="teamBName">Equipo B</span>
      </div>
    </div>

    <div class="live-actions">
      <a id="liveLink" href="#" target="_blank" class="live-btn hidden">
        Ver transmisi√≥n
      </a>
    </div>
	
	<div class="video-wrapper">
	  <iframe
		id="liveIframe"
		src=""
		frameborder="0"
		scrolling="no"
		allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"
		allowfullscreen>
	  </iframe>
	</div>
	
	
  </div>
</div>

<!-- PANEL INFO PARTIDO -->
<div id="match-info-panel" class="match-info-panel">

    <div class="match-info-card">

        <h3>Informaci√≥n del Partido</h3>

        <p id="info-teams">
            --
        </p>

        <button id="close-info">
            Cerrar
        </button>

    </div>

</div>


<!-- GOOGLE SHEETS LOADER del Maestro del evento -->
<script>
	/* ===== CONFIGURACI√ìN MASTER ===== */
	const MASTER_SHEET_ID = "1vTALPZ2DL2D0n8cptzD-__LjhKJT1kXwDks6ucYVGtY";
	const MASTER_URL = `https://docs.google.com/spreadsheets/d/${MASTER_SHEET_ID}/gviz/tq?tqx=out:json&sheet=Eventos`;
</script>

<script>
function getEventFromURL() {
  const params = new URLSearchParams(window.location.search);
  return params.get("event");
}
</script>



<script>
function loadEventSheetId(callback) {
  fetch(MASTER_URL)
    .then(res => res.text())
    .then(text => {
      const json = JSON.parse(text.substring(47).slice(0, -2));
      const rows = json.table.rows;
      const eventId = getEventFromURL();

      for (let r of rows) {
        const row = r.c;
        const masterEventId = row[0]?.v;   // Columna A: event_id
		const masterEventName = row[1]?.v;   // Columna B: event_name
        const sheetId = row[2]?.v;          // Columna C: sheet_id
        const status = row[3]?.v;           // Columna D: status

        if (masterEventId === eventId && status === "active") {
		
          // üîπ INYECTAR NOMBRE DEL EVENTO EN EL BODY
          const titleEl = document.getElementById("eventTitle");
          if (titleEl && masterEventName) {
            titleEl.textContent = masterEventName;
          }

          // üîπ CONTINUAR FLUJO NORMAL		
		
          callback(sheetId);
          return;
        }
      }

      console.error("Evento no encontrado o no activo en MASTER");
    });
}
</script>
<!-- Definiendo URL`s GOOGLE SHEETS del detalle del evento para pesta√±as Bracket y LiveInput -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  loadEventSheetId(sheetId => {

    const BRACKET_URL = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=Bracket`;
    const LIVEINPUT_URL = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=LiveInput`;

    /* === LLAMADAS EXISTENTES (NO LAS ROMPE) === */
    // loadBracket(BRACKET_URL);    //  tu funci√≥n actual
    // loadLiveInputFromURL(LIVEINPUT_URL); // overlay LIVE / ON-DEMAND

  });
});
</script>

<!-- GOOGLE SHEETS LOADER del detalle del evento para los datos de la capa Bracket -->
<script>
function loadBracket(url) {
  fetch(url)
  .then(res => res.text())
  .then(text => {
  
    console.log("üìÑ Respuesta cruda GViz recibida");

    const jsonBracket = JSON.parse(text.substring(47).slice(0, -2));
    const rowsBracket = jsonBracket.table.rows;

    console.log("üìä Total de filas le√≠das en Bracket:", rowsBracket.length);

    if (rowsBracket.length === 0) {
      alert("‚ö†Ô∏è La pesta√±a Bracket est√° vac√≠a o no se ley√≥ correctamente");  
	}

    rowsBracket.forEach((row, index) => {
		
		console.log(`‚û°Ô∏è Fila ${index + 1} completa:`, row.c);
	
	
	
      const matchId = row.c[0]?.v;
	  const Jornada = row.c[1]?.v || "";
      const team1   = row.c[2]?.v || "";
      const team2   = row.c[3]?.v || "";
	  const score   = row.c[4]?.v || "";
      const date    = row.c[5]?.v || "";
      const time    = row.c[6]?.v || "";
	  
		console.log("üÜî matchId:", matchId, "| Jornada:", Jornada);
      
          // üîπ INYECTAR Jornadas por jugar EN EL BODY
          const Jor1 = document.getElementById("Jornada-1");
          if (Jor1 && Jornada) {
            Jor1.textContent = Jornada;
          }

          // üîπ CONTINUAR FLUJO NORMAL	 
		  
	  const IdMatch = `${matchId)-${Jornada}`;

      const card = document.querySelector(`[data-match="${matchId}"]`);
      if (!card) {
		  console.warn("‚ùå No se encontr√≥ tarjeta para data-match =", matchId);
		  return;
		}
		
		console.log("‚úÖ Tarjeta encontrada para:", matchId);
		
      card.querySelector(".team1").textContent = team1;
      card.querySelector(".team2").textContent = team2;
      card.querySelector(".meta").textContent =
        `Fecha: ${date} | Hora: ${time} | Marcador: ${score}`;
		
		alert(`Fila le√≠da:
		Match: ${matchId}
		${team1} vs ${team2}`);
		
		
    });
  })
  .catch(err => {
      console.error("‚ùå Error cargando Bracket:", err);
  });
}
</script>

<script>
/* ===== GOOGLE SHEETS LOADER ‚Äî LIVE CARD (LIGHT) ===== */

function loadLiveInputFromURL(url) {
  fetch(url)
    .then(res => res.text())
    .then(text => {
      const json = JSON.parse(text.substring(47).slice(0, -2));
      const row = json.table.rows[0]?.c;

      if (!row) return;

      const scoreA = row[1]?.v;
      const scoreB = row[2]?.v;
      const liveUrl = row[3]?.v;

      if (scoreA == null || scoreB == null) return;

      document.getElementById("scoreA").textContent = scoreA;
      document.getElementById("scoreB").textContent = scoreB;

		if (liveUrl && liveUrl.trim() !== "") {
		  const iframeSrc =
			"https://www.facebook.com/plugins/video.php?href=" +
			encodeURIComponent(liveUrl) +
			"&show_text=true";

		  liveIframe.src = iframeSrc;
		  liveVideoCard.classList.remove("hidden");
		}

      document.getElementById("liveOverlay").classList.remove("hidden");
    });
}

</script>

<script>
/* ================================
   Google Sheets Loader iPV
   ================================ */

const LIVE_URL =
"https://opensheet.elk.sh/1H7UgDZnPysrgo65u5_WD63tiuwSDPvFQCou5-BnpqXE/LiveInput";

const BRACKET_URL =
"https://opensheet.elk.sh/1H7UgDZnPysrgo65u5_WD63tiuwSDPvFQCou5-BnpqXE/Bracket";

// ===============================
// CONTROL TIEMPO ACTUALIZACI√ìN
// ===============================

let lastUpdateTimestamp = null;
let lastRenderedScore = "";


/* Cargar Marcador */
/* ===============================
   LOAD LIVE SCORE OPTIMIZADO
   =============================== */

let lastLiveState = {};

async function loadLiveScore(){

    try{

        const res = await fetch(LIVE_URL);
        const data = await res.json();

        if(!Array.isArray(data)) return null;

        let currentSnapshot = {};

        data.forEach(row => {

            const id = row.match_id;
            if(!id) return;

            const scoreA = row.score_a || "0";
            const scoreB = row.score_b || "0";
            const liveURL = row.live_url || "";
            const status  = row.Estado || row.status || "";
            const updatedAt = row.Actualizado || "";

            const scoreText = `${scoreA}:${scoreB}`;

            // Hash ligero del partido
            const hash = `${scoreText}|${status}|${liveURL}`;

            currentSnapshot[id] = hash;

            // Comparar con estado previo
            if(lastLiveState[id] === hash){
                return; // ‚ùå No cambi√≥ ‚Üí no tocar DOM
            }

            lastLiveState[id] = hash;

            // ===============================
            // Buscar tarjeta
            // ===============================

            const card = document.querySelector(
                `[data-match-id="${id}"]`
            );

            if(!card) return;

            // ===============================
            // Actualizar marcador
            // ===============================

            const scoreEl = card.querySelector(".score");

            if(scoreEl){
                scoreEl.textContent = `${scoreA} : ${scoreB}`;
            }

            // ===============================
            // Control LIVE
            // ===============================

			 const link =
				card.querySelector(".live-link") ||
				document.querySelector(`#marcador .live-link`);

			if(!link){
				console.warn("LIVE no encontrado para", id);
				return;
			}


            if(status === "LIVE"){

                link.style.display = "inline-block";
                link.textContent = "EN VIVO";
                link.classList.add("live-active");

                if(liveURL && liveURL.trim() !== ""){
                    link.href = liveURL;
                    link.target = "_blank";
                }else{
                    link.removeAttribute("href");
                }

            }else{

                link.style.display = "none";
                link.classList.remove("live-active");
                link.removeAttribute("href");

            }

            // ===============================
            // Timestamp actualizaci√≥n
            // ===============================

            if(updatedAt){

                const ts = new Date(updatedAt).getTime();

                if(!isNaN(ts)){
                    lastUpdateTimestamp = ts;
                }

            }

        });

        return currentSnapshot;

    }catch(e){

        console.error("Error loadLiveScore:", e);
        return null;

    }

}



/* Cargar Bracket */
async function loadBracket(){

    const res = await fetch(BRACKET_URL);
    const data = await res.json();

    data.forEach(row => {

        const id = row.id;

        const card = document.querySelector(
            `[data-bracket-id="${id}"]`
        );

        if(card){

            card.querySelector(".teams")
                .textContent =
                `${row.equipo1} vs ${row.equipo2}`;

            card.querySelector(".meta")
                .textContent =
                `Fecha: ${row.fecha} | Hora: ${row.hora} | ${row.Estado}`;
        }
    });
}

// ===============================
// CONTROL DE CAMBIOS
// ===============================
let lastLiveHash = "";

// ===============================
// LEER REFRESH DESDE GOOGLE SHEETS
// ===============================
async function getRefreshTime(){

    try{

        const url = "https://opensheet.elk.sh/1H7UgDZnPysrgo65u5_WD63tiuwSDPvFQCou5-BnpqXE/LiveInput";

        const res = await fetch(url);
        const data = await res.json();

        if(!data || !data.length){
            return 1000; // default 1s
        }

        const refreshValue = data[0].Refresh;

        const parsed = parseInt(refreshValue);

        if(isNaN(parsed) || parsed < 500){
            return 1000; // m√≠nimo seguro
        }

        return parsed;

    }catch(e){

        console.warn("Refresh inv√°lido, usando default", e);
        return 1000;

    }

}

// ===============================
// CARGA CON VALIDACI√ìN
// ===============================
async function refreshDashboard(){

    const currentData = await loadLiveScore(true);
    await loadBracket();

    if(!currentData) return;

    const hash = JSON.stringify(currentData);

    if(hash === lastLiveHash){
        return; // No cambi√≥ nada
    }

    lastLiveHash = hash;

}


// ===============================
// AUTO REFRESCO DIN√ÅMICO
// ===============================
async function initDashboard(){

    // Primera carga
    await refreshDashboard();

    // Leer tiempo desde Sheets
    const refreshTime = await getRefreshTime();

    console.log("Refresh configurado:", refreshTime, "ms");

    // Loop din√°mico
    setInterval(async ()=>{

        await refreshDashboard();

    }, refreshTime);

}

document.addEventListener("DOMContentLoaded", initDashboard);

// ===============================
// RELOJ + CONTADOR ACTUALIZACI√ìN
// ===============================

function initClock(){

    setInterval(()=>{

        // Hora actual
        const now = new Date();

        const h = now.getHours().toString().padStart(2,"0");
        const m = now.getMinutes().toString().padStart(2,"0");

        const clock = document.getElementById("clock-now");

        if(clock){
            clock.textContent = `üïí ${h}:${m}`;
        }

        // Tiempo desde √∫ltima actualizaci√≥n
        const last = document.getElementById("last-update");

        if(last && lastUpdateTimestamp){

            const diff = Math.floor(
                (Date.now() - lastUpdateTimestamp)/1000
            );

            last.textContent = `Actualizado hace ${diff}s`;
        }

    },1000);

}

</script>


</body>
</html>
